<div class="flex flex-col h-96" data-controller="chat">
  <% if CoEngineWorkspace.llm_available? %>
    <%# Message list %>
    <div id="workspace-chat-messages"
         class="flex-1 overflow-y-auto space-y-3 p-3"
         data-chat-target="messages">
      <%= render "co_engine_workspace/chat_messages", conversation: workspace_conversation %>
    </div>

    <%# Input area %>
    <%= form_with url: co_engine_workspace.chat_messages_path,
                  method: :post,
                  data: { chat_target: "form", action: "chat#submit" } do |f| %>
      <div class="border-t border-gray-200 p-3 flex gap-2">
        <%= f.text_area :message,
            placeholder: "Ask about this page...",
            rows: 1,
            class: "flex-1 resize-none rounded-lg border border-gray-300 px-3 py-2 text-sm " \
                   "focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",
            data: { chat_target: "input", action: "keydown->chat#keydown" } %>
        <%= f.submit "Send",
            class: "px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg " \
                   "hover:bg-primary-700 transition-colors cursor-pointer" %>
      </div>
    <% end %>
  <% else %>
    <div class="flex items-center justify-center h-full text-gray-400 text-sm">
      <div class="text-center">
        <svg class="w-8 h-8 mx-auto mb-2 text-gray-300" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
        </svg>
        <p>Chat not available</p>
        <p class="text-xs text-gray-300 mt-1">engine-llm is not loaded</p>
      </div>
    </div>
  <% end %>
</div>
